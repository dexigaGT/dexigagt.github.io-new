---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { ChevronLeft } from 'lucide-react';

export async function getStaticPaths() {
  const posts = await getCollection('projects');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();

const formattedDate = post.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Layout title={post.data.title}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-20">
     <div class="lg:grid lg:grid-cols-12 lg:gap-8">
       
       {/* Main Content */}
       <article class="lg:col-span-8">
          
          <div class="flex items-center gap-2 mb-6 text-sm">
             <a href="/projects" class="inline-flex items-center gap-1 text-gray-500 hover:text-green-600 dark:text-gray-400 dark:hover:text-green-400 transition-colors">
               <ChevronLeft className="w-4 h-4" /> Back to Projects
             </a>
          </div>

          <div class="mb-8">
             <div class="flex items-center gap-4 mb-4">
               <span class="inline-block px-3 py-1 text-xs font-semibold tracking-wider text-green-700 uppercase bg-green-100 dark:bg-green-900/30 dark:text-green-400 rounded-full">
                 {post.data.category}
               </span>
               <time class="text-sm text-gray-500 dark:text-gray-400">{formattedDate}</time>
             </div>
             
             <h1 class="text-3xl md:text-5xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
               {post.data.title}
             </h1>

              {post.data.coverImage && (
                 <div class="aspect-video w-full overflow-hidden rounded-xl mb-8 bg-gray-100 dark:bg-zinc-800">
                   <img src={post.data.coverImage} alt={post.data.title} class="w-full h-full object-cover" />
                 </div>
              )}
          </div>
          
          <div class="prose prose-lg dark:prose-invert prose-headings:font-bold prose-headings:tracking-tight prose-a:text-green-600 dark:prose-a:text-green-400 hover:prose-a:text-green-500 max-w-none">
             <Content />
          </div>
       </article>

       {/* Sidebar */}
       <aside class="hidden lg:block lg:col-span-4 pl-8">
          <div class="sticky top-24 space-y-8">
             <div>
                <h3 class="text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider mb-4">
                  On this page
                </h3>
                <nav>
                  {headings.length > 0 ? (
                    <ul class="space-y-3 text-sm">
                      {headings.map(heading => (
                        <li class={`pl-${Math.max(0, (heading.depth - 2) * 4)}`}>
                          <a href={`#${heading.slug}`} class="text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 transition-colors block border-l-2 border-transparent hover:border-green-600 pl-3 -ml-0.5">
                            {heading.text}
                          </a>
                        </li>
                      ))}
                    </ul>
                  ) : (
                    <p class="text-sm text-gray-500 italic">No table of contents</p>
                  )}
                </nav>
             </div>
             
             <div class="p-6 bg-gray-50 dark:bg-zinc-900/50 rounded-2xl border border-gray-100 dark:border-zinc-800">
                <h3 class="font-bold text-gray-900 dark:text-white mb-2">About the Author</h3>
                 <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                   Hi! I'm David Exiga, a Master's student at Georgia Tech specializing in Robotics and AI.
                 </p>
                 <a href="/" class="text-sm font-medium text-green-600 dark:text-green-400 hover:underline">
                    View Profile &rarr;
                 </a>
             </div>
          </div>
       </aside>

     </div>
  </div>
</Layout>
